<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ê°„ë‹¨í•œ ìŒë£Œ ìíŒê¸°</title>
  <style>
    body {font-family: Arial, sans-serif; background: #f0f4ff; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0;}
    .vending {background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 400px;}
    h2 {text-align: center; margin-bottom: 20px;}
    .coins {display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;}
    .coin {padding: 8px 12px; background: #e0eaff; border: 1px solid #a5b4fc; border-radius: 10px; cursor: pointer; font-weight: bold;}
    .coin:active {transform: translateY(1px);}
    .change {display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;}
    .change-btn {padding: 8px 12px; background: #e0eaff; border: 1px solid #a5b4fc; border-radius: 10px; cursor: pointer; font-weight: bold;}
    .balance {text-align: center; margin-bottom: 20px; font-weight: bold;}
    .products {display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;}
  .item {background: #f9fafb; border: 1px solid #d1d5db; border-radius: 10px; padding: 10px; text-align: center; cursor: pointer; position: relative;}
  .item.available {background: #e6f0ff; border-color: #93c5fd;} /* íŒŒë€ ë°°ê²½: êµ¬ë§¤ ê°€ëŠ¥ */
  .item.soldout {background: #ffe6e6; border-color: #fca5a5; cursor: not-allowed;} /* ë¹¨ê°„ ë°°ê²½: í’ˆì ˆ */
  .stock {position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.06); padding: 2px 6px; border-radius: 8px; font-size: 12px;}
    .item img {width: 50px; height: 50px; object-fit: contain;}
    .item h4 {margin: 8px 0 4px 0; font-size: 14px;}
    .price {font-size: 13px; color: #3b82f6;}
  </style>
</head>
<body>
  <div class="vending">
    <h2>ìŒë£Œ ìíŒê¸°</h2>
    <div class="coins" id="coins"></div>
    <div class="balance">ì”ì•¡: <span id="balance">0</span>ì›</div>
    <div class="change" id="change"></div>
    <div class="products" id="productGrid"></div>
  </div>

  <script>
    const PRODUCTS = [
      {id:1,name:'ì½œë¼',price:1200,emoji:'ğŸ¥¤', stock:5},
      {id:2,name:'ì‚¬ì´ë‹¤',price:1100,emoji:'ğŸ§ƒ', stock:5},
      {id:3,name:'ìƒìˆ˜',price:800,emoji:'ğŸ’§', stock:5},
      {id:4,name:'ì»¤í”¼',price:1500,emoji:'â˜•', stock:5},
      {id:5,name:'ì—ë„ˆì§€',price:2000,emoji:'âš¡', stock:5},
      {id:6,name:'ì£¼ìŠ¤',price:1300,emoji:'ğŸŠ', stock:5},
    ];

    const BAD_PRODUCT = [
      {id:7,name:'ìš°ìœ (ê±¸ë¦¼/ë¶ˆëŸ‰)',price:900,emoji:'ğŸ¥›', stock:5},
      {id:8,name:'í‹°(ê±¸ë¦¼/ë¶ˆëŸ‰)',price:1000,emoji:'ğŸµ', stock:5},
      {id:9,name:'ìŠ¤í¬ì¸ (ê±¸ë¦¼/ë¶ˆëŸ‰)',price:1400,emoji:'ğŸƒ', stock:5}
    ]
    
    const COINS = [500,10,100,50];
    const BAD_COINS = ['23(ë¶ˆëŸ‰)'];
    
    const coinsEl = document.getElementById('coins');
    const balanceEl = document.getElementById('balance');
    const changeBtn = document.getElementById('change');
    const productGrid = document.getElementById('productGrid');

    const productEls = new Map();
    let balance = 0;

    const renderCoins = () => {
      [...COINS, ...BAD_COINS].forEach(val => {
        const btn = document.createElement('button');
        btn.className = 'coin';
        btn.textContent = `${val}ì›`;
        btn.onclick = () => {
          if (checkValidCoin(val)) {
            insertCoin(val);
          } else {
            alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë™ì „ì…ë‹ˆë‹¤.');
          }
        };
        coinsEl.appendChild(btn);
      });
    }

    const renderProducts = () => {
      [...PRODUCTS, ...BAD_PRODUCT].forEach(p => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <div style="font-size:30px">${p.emoji}</div>
          <h4>${p.name}</h4>
          <div class="price">${format(p.price)}ì›</div>
          <div class="stock">ë‚¨ì€: <span class="count">${p.stock}</span></div>
        `;

        div.onclick = () => {
          if(!checkValidProduct(p)) p.status = 'bad'
          buyProduct(p)
        }
        productGrid.appendChild(div);
        productEls.set(p.id, {root: div, product: p});
      });

      updateAllProductsUI();
    }

    const renderReturnChangeBtn= () => {
      const btn = document.createElement('button');
      btn.className = 'change-btn';
      btn.textContent = 'ì”ëˆ ë°˜í™˜';
      btn.onclick = () => {
        if(balance > 0){
          balance = 0;
          updateBalance();
          alert(`ì”ëˆì„ ë°˜í™˜í•©ë‹ˆë‹¤.`);
        } else {
          alert(`ë°˜í™˜í•  ì”ëˆì´ ì—†ìŠµë‹ˆë‹¤.`);
        }
      };
      changeBtn.appendChild(btn);
    }

    const buyProduct = (p) => {
      if (p.stock <= 0) return; 
      if(balance >= p.price){
        if(p.status === 'bad'){
          alert(`ê±¸ë¦¼/ë¶ˆëŸ‰ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`);
        } else {
          balance -= p.price;
          p.stock -= 1;
          updateBalance();
          alert(`${p.name} êµ¬ë§¤ ì™„ë£Œ!`);  
        }
      } else {
        alert(`ê¸ˆì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.`);
      }
      updateAllProductsUI()
    }

    const updateProductUI = (id) => {
      const entry = productEls.get(id);
      if(!entry) return;
      const {root, product} = entry;
      const countEl = root.querySelector('.count');
      countEl.textContent = product.stock;
      console.log(product)
       if(balance >= product.price){
          root.classList.add('available');
        }
      if(product.stock <= 0){
        root.classList.remove('available');
        root.classList.add('soldout');
      }
    }

    const updateAllProductsUI = () => {
      productEls.forEach(({root, product}) => {
        const countEl = root.querySelector('.count');
        countEl.textContent = product.stock;
        root.classList.remove('available');
        root.classList.remove('soldout');

        if(balance >= product.price){
          root.classList.add('available');
        }
        if(product.stock <= 0 || product?.status === 'bad'){
          root.classList.add('soldout');
        } 
      });
    }

    const updateBalance = () => {
      balanceEl.textContent = format(balance);
      updateAllProductsUI();
    }

    const checkValidCoin = (coin) => {
      return COINS.includes(coin);
    }

    const checkValidProduct = (coin) => {
      return PRODUCTS.includes(coin);
    }

    const insertCoin = (coin) => {
      balance += coin;
      updateBalance();
    }

    const format = (n) => n.toLocaleString();

    renderCoins();
    renderProducts();
    renderReturnChangeBtn();
  </script>
</body>
</html>
